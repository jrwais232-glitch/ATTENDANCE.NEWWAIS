<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Management System</title>
  <style>
    :root {
      --primary: #004080;
      --primary-light: #0066cc;
      --secondary: #f2f4f7;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --dark: #343a40;
      --light: #f8f9fa;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--secondary);
      line-height: 1.6;
      color: #333;
    }
    
    header {
      background: var(--primary);
      color: white;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      padding: 25px;
      margin-bottom: 20px;
    }
    
    h1, h2, h3, h4 {
      color: var(--primary);
      margin-bottom: 15px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    input, select, textarea, button {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    button {
      background: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }
    
    button:hover {
      background: var(--primary-light);
    }
    
    button.secondary {
      background: var(--dark);
    }
    
    button.secondary:hover {
      background: #495057;
    }
    
    button.success {
      background: var(--success);
    }
    
    button.danger {
      background: var(--danger);
    }
    
    .hidden {
      display: none;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    table, th, td {
      border: 1px solid #ddd;
    }
    
    th, td {
      padding: 12px;
      text-align: left;
    }
    
    th {
      background: var(--primary);
      color: white;
    }
    
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .dashboard-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .alert {
      padding: 12px 15px;
      border-radius: 5px;
      margin: 15px 0;
    }
    
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .eligibility-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
    }
    
    .eligible {
      background: #d4edda;
      color: #155724;
    }
    
    .not-eligible {
      background: #f8d7da;
      color: #721c24;
    }
    
    .attendance-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .login-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .login-option {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .login-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .login-option h3 {
      margin-bottom: 10px;
    }
    
    .login-option p {
      color: #666;
      margin-bottom: 20px;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: var(--primary);
      margin: 10px 0;
    }
    
    .stat-label {
      color: #666;
      font-size: 0.9rem;
    }
    
    .appeal-status {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
    }
    
    .pending {
      background: #fff3cd;
      color: #856404;
    }
    
    .approved {
      background: #d4edda;
      color: #155724;
    }
    
    .rejected {
      background: #f8d7da;
      color: #721c24;
    }
    
    @media (max-width: 768px) {
      .dashboard-actions {
        grid-template-columns: 1fr;
      }
      
      .login-options {
        grid-template-columns: 1fr;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Attendance Management System</h1>
  </header>

  <div class="container">
    <!-- Role Selection Screen -->
    <section id="role-selection">
      <div class="card">
        <h2>Select Your Role</h2>
        <p>Choose how you want to access the system</p>
        
        <div class="login-options">
          <div class="login-option" onclick="showLoginForm('admin')">
            <h3>Administrator</h3>
            <p>Manage students, lecturers, and generate reports</p>
            <button>Login as Admin</button>
          </div>
          
          <div class="login-option" onclick="showLoginForm('lecturer')">
            <h3>Lecturer</h3>
            <p>Record attendance and view student progress</p>
            <button>Login as Lecturer</button>
          </div>
          
          <div class="login-option" onclick="showLoginForm('student')">
            <h3>Student</h3>
            <p>View your attendance and eligibility status</p>
            <button>Login as Student</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Login -->
    <section id="admin-login" class="hidden">
      <div class="card">
        <h2>Admin Login</h2>
        <form id="admin-login-form">
          <div class="form-group">
            <label for="admin-username">Username:</label>
            <input type="text" id="admin-username" required>
          </div>
          <div class="form-group">
            <label for="admin-password">Password:</label>
            <input type="password" id="admin-password" required>
          </div>
          <button type="submit">Login</button>
          <button type="button" class="secondary" onclick="showRoleSelection()">Back</button>
        </form>
        <div id="admin-login-alert" class="alert hidden"></div>
      </div>
    </section>

    <!-- Lecturer Login -->
    <section id="lecturer-login" class="hidden">
      <div class="card">
        <h2>Lecturer Login</h2>
        <form id="lecturer-login-form">
          <div class="form-group">
            <label for="lecturer-id">Lecturer ID:</label>
            <input type="text" id="lecturer-id" required>
          </div>
          <div class="form-group">
            <label for="lecturer-password">Password:</label>
            <input type="password" id="lecturer-password" required>
          </div>
          <button type="submit">Login</button>
          <button type="button" class="secondary" onclick="showRoleSelection()">Back</button>
        </form>
        <div id="lecturer-login-alert" class="alert hidden"></div>
        
        <div class="form-group" style="margin-top: 20px;">
          <p>Don't have an account? <a href="#" onclick="showLecturerRegistration()">Register here</a></p>
        </div>
      </div>
    </section>

    <!-- Student Login -->
    <section id="student-login" class="hidden">
      <div class="card">
        <h2>Student Login</h2>
        <form id="student-login-form">
          <div class="form-group">
            <label for="student-reg">Registration Number:</label>
            <input type="text" id="student-reg" required>
          </div>
          <div class="form-group">
            <label for="student-password">Password:</label>
            <input type="password" id="student-password" required>
          </div>
          <button type="submit">Login</button>
          <button type="button" class="secondary" onclick="showRoleSelection()">Back</button>
        </form>
        <div id="student-login-alert" class="alert hidden"></div>
        
        <div class="form-group" style="margin-top: 20px;">
          <p>Don't have an account? <a href="#" onclick="showStudentRegistration()">Register here</a></p>
        </div>
      </div>
    </section>

    <!-- Lecturer Registration -->
    <section id="lecturer-registration" class="hidden">
      <div class="card">
        <h2>Lecturer Registration</h2>
        <form id="lecturer-reg-form">
          <div class="form-group">
            <label for="lecturer-name">Full Name:</label>
            <input type="text" id="lecturer-name" required>
          </div>
          <div class="form-group">
            <label for="lecturer-id-reg">Lecturer ID:</label>
            <input type="text" id="lecturer-id-reg" required>
          </div>
          <div class="form-group">
            <label for="lecturer-email">Email:</label>
            <input type="email" id="lecturer-email" required>
          </div>
          <div class="form-group">
            <label for="lecturer-department">Department:</label>
            <input type="text" id="lecturer-department" required>
          </div>
          <div class="form-group">
            <label for="lecturer-password-reg">Password:</label>
            <input type="password" id="lecturer-password-reg" required>
          </div>
          <div class="form-group">
            <label for="lecturer-confirm-password">Confirm Password:</label>
            <input type="password" id="lecturer-confirm-password" required>
          </div>
          <button type="submit">Register</button>
          <button type="button" class="secondary" onclick="showLoginForm('lecturer')">Back to Login</button>
        </form>
        <div id="lecturer-reg-alert" class="alert hidden"></div>
      </div>
    </section>

    <!-- Student Registration -->
    <section id="student-registration" class="hidden">
      <div class="card">
        <h2>Student Registration</h2>
        <form id="student-reg-form">
          <div class="form-group">
            <label for="student-name">Full Name:</label>
            <input type="text" id="student-name" required>
          </div>
          <div class="form-group">
            <label for="student-reg-reg">Registration Number:</label>
            <input type="text" id="student-reg-reg" required>
          </div>
          <div class="form-group">
            <label for="student-email">Email:</label>
            <input type="email" id="student-email" required>
          </div>
          <div class="form-group">
            <label for="student-course">Course:</label>
            <input type="text" id="student-course" required>
          </div>
          <div class="form-group">
            <label for="student-semester">Semester:</label>
            <select id="student-semester" required>
              <option value="">Select Semester</option>
              <option value="1">Semester 1</option>
              <option value="2">Semester 2</option>
              <option value="3">Semester 3</option>
              <option value="4">Semester 4</option>
              <option value="5">Semester 5</option>
              <option value="6">Semester 6</option>
              <option value="7">Semester 7</option>
              <option value="8">Semester 8</option>
            </select>
          </div>
          <div class="form-group">
            <label for="student-password-reg">Password:</label>
            <input type="password" id="student-password-reg" required>
          </div>
          <div class="form-group">
            <label for="student-confirm-password">Confirm Password:</label>
            <input type="password" id="student-confirm-password" required>
          </div>
          <button type="submit">Register</button>
          <button type="button" class="secondary" onclick="showLoginForm('student')">Back to Login</button>
        </form>
        <div id="student-reg-alert" class="alert hidden"></div>
      </div>
    </section>

    <!-- Admin Dashboard -->
    <section id="admin-dashboard" class="hidden">
      <div class="dashboard-header">
        <h2>Admin Dashboard</h2>
        <button class="danger" onclick="logout()">Logout</button>
      </div>
      
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-label">Total Students</div>
          <div class="stat-value" id="total-students">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Lecturers</div>
          <div class="stat-value" id="total-lecturers">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Eligible Students</div>
          <div class="stat-value" id="eligible-students">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Overall Eligibility</div>
          <div class="stat-value" id="eligibility-rate">0%</div>
        </div>
      </div>
      
      <div class="dashboard-actions">
        <button onclick="showAdminSection('manage-students')">Manage Students</button>
        <button onclick="showAdminSection('manage-lecturers')">Manage Lecturers</button>
        <button onclick="showAdminSection('attendance-records')">Attendance Records</button>
        <button onclick="showAdminSection('appeals-management')">Manage Appeals</button>
        <button onclick="showAdminSection('generate-reports')">Generate Reports</button>
      </div>
      
      <!-- Manage Students Section -->
      <div id="manage-students" class="admin-section hidden">
        <div class="card">
          <h3>Student Management</h3>
          <button onclick="showStudentRegistration()" class="success" style="width: auto; margin-bottom: 15px;">Add New Student</button>
          <table id="students-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Registration No.</th>
                <th>Course</th>
                <th>Semester</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Manage Lecturers Section -->
      <div id="manage-lecturers" class="admin-section hidden">
        <div class="card">
          <h3>Lecturer Management</h3>
          <button onclick="showLecturerRegistration()" class="success" style="width: auto; margin-bottom: 15px;">Add New Lecturer</button>
          <table id="lecturers-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Lecturer ID</th>
                <th>Department</th>
                <th>Email</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Attendance Records Section -->
      <div id="attendance-records" class="admin-section hidden">
        <div class="card">
          <h3>Attendance Records</h3>
          <table id="attendance-table">
            <thead>
              <tr>
                <th>Student Name</th>
                <th>Registration No.</th>
                <th>Total Lectures</th>
                <th>Attended</th>
                <th>Percentage</th>
                <th>Eligibility</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Appeals Management Section -->
      <div id="appeals-management" class="admin-section hidden">
        <div class="card">
          <h3>Student Appeals Management</h3>
          <table id="appeals-table">
            <thead>
              <tr>
                <th>Student Name</th>
                <th>Registration No.</th>
                <th>Appeal Date</th>
                <th>Reason</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Generate Reports Section -->
      <div id="generate-reports" class="admin-section hidden">
        <div class="card">
          <h3>Generate Reports</h3>
          <div class="form-group">
            <label for="report-type">Report Type:</label>
            <select id="report-type">
              <option value="eligibility">Eligibility Report</option>
              <option value="attendance">Detailed Attendance Report</option>
              <option value="students">Student List</option>
              <option value="lecturers">Lecturer List</option>
              <option value="appeals">Appeals Report</option>
            </select>
          </div>
          <button onclick="generateReport()">Generate Report</button>
          <button onclick="exportToCSV()" style="width: auto; margin-top: 10px;">Export to CSV</button>
          
          <div id="report-results" style="margin-top: 20px;"></div>
        </div>
      </div>
    </section>

    <!-- Lecturer Dashboard -->
    <section id="lecturer-dashboard" class="hidden">
      <div class="dashboard-header">
        <h2>Lecturer Dashboard</h2>
        <button class="danger" onclick="logout()">Logout</button>
      </div>
      
      <div class="card">
        <h3>Welcome, <span id="lecturer-name-display"></span></h3>
        <p>Department: <span id="lecturer-dept-display"></span></p>
      </div>
      
      <div class="dashboard-actions">
        <button onclick="showLecturerSection('record-attendance')">Record Attendance</button>
        <button onclick="showLecturerSection('view-students')">View Students</button>
        <button onclick="showLecturerSection('attendance-report')">Attendance Report</button>
      </div>
      
      <!-- Record Attendance Section -->
      <div id="record-attendance" class="lecturer-section hidden">
        <div class="card">
          <h3>Record Attendance</h3>
          <form id="record-attendance-form">
            <div class="form-group">
              <label for="attendance-student">Select Student:</label>
              <select id="attendance-student" required>
                <option value="">Select Student</option>
              </select>
            </div>
            <div class="form-group">
              <label for="attendance-subject">Subject:</label>
              <input type="text" id="attendance-subject" required>
            </div>
            <div class="form-group">
              <label for="attendance-date">Date:</label>
              <input type="date" id="attendance-date" required>
            </div>
            <div class="form-group">
              <label for="attendance-status">Status:</label>
              <select id="attendance-status" required>
                <option value="present">Present</option>
                <option value="absent">Absent</option>
              </select>
            </div>
            <button type="submit">Record Attendance</button>
          </form>
          <div id="attendance-alert" class="alert hidden"></div>
        </div>
      </div>
      
      <!-- View Students Section -->
      <div id="view-students" class="lecturer-section hidden">
        <div class="card">
          <h3>Student List</h3>
          <table id="lecturer-students-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Registration No.</th>
                <th>Course</th>
                <th>Semester</th>
                <th>Attendance %</th>
                <th>Eligibility</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Attendance Report Section -->
      <div id="attendance-report" class="lecturer-section hidden">
        <div class="card">
          <h3>Attendance Report</h3>
          <div class="form-group">
            <label for="report-subject">Select Subject:</label>
            <select id="report-subject">
              <option value="all">All Subjects</option>
            </select>
          </div>
          <button onclick="generateLecturerReport()">Generate Report</button>
          
          <div id="lecturer-report-results" style="margin-top: 20px;"></div>
        </div>
      </div>
    </section>

    <!-- Student Dashboard -->
    <section id="student-dashboard" class="hidden">
      <div class="dashboard-header">
        <h2>Student Dashboard</h2>
        <button class="danger" onclick="logout()">Logout</button>
      </div>
      
      <div class="card">
        <h3>Welcome, <span id="student-name-display"></span></h3>
        <p>Registration No.: <span id="student-reg-display"></span></p>
        <p>Course: <span id="student-course-display"></span> | Semester: <span id="student-semester-display"></span></p>
      </div>
      
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-label">Overall Attendance</div>
          <div class="stat-value" id="student-attendance-percent">0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Lectures</div>
          <div class="stat-value" id="student-total-lectures">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Lectures Attended</div>
          <div class="stat-value" id="student-attended-lectures">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Eligibility Status</div>
          <div class="stat-value" id="student-eligibility-status">-</div>
        </div>
      </div>
      
      <!-- Appeal Section -->
      <div class="card">
        <h3>Appeal for Exam Eligibility</h3>
        <p id="appeal-info">Your current attendance is below the required 75%. If you have valid reasons for your low attendance, you can submit an appeal for consideration.</p>
        
        <div id="appeal-form">
          <form id="submit-appeal-form">
            <div class="form-group">
              <label for="appeal-reason">Reason for Appeal:</label>
              <select id="appeal-reason" required>
                <option value="">Select a reason</option>
                <option value="medical">Medical Reasons</option>
                <option value="family">Family Emergency</option>
                <option value="official">Official College Work</option>
                <option value="other">Other Valid Reasons</option>
              </select>
            </div>
            <div class="form-group">
              <label for="appeal-details">Detailed Explanation:</label>
              <textarea id="appeal-details" rows="4" placeholder="Please provide detailed explanation for your appeal..." required></textarea>
            </div>
            <div class="form-group">
              <label for="supporting-docs">Supporting Documents (if any):</label>
              <input type="file" id="supporting-docs">
              <small>You can upload medical certificates, official letters, or other supporting documents.</small>
            </div>
            <button type="submit" class="success">Submit Appeal</button>
          </form>
        </div>
        
        <div id="appeal-status" class="hidden">
          <h4>Your Appeal Status</h4>
          <div class="alert" id="appeal-status-alert">
            <p><strong>Appeal Date:</strong> <span id="appeal-date">October 15, 2023</span></p>
            <p><strong>Reason:</strong> <span id="appeal-reason-display">Medical Reasons</span></p>
            <p><strong>Status:</strong> <span id="appeal-status-display" class="appeal-status pending">Pending Review</span></p>
            <p><strong>Details:</strong> <span id="appeal-details-display">I was hospitalized for two weeks due to severe illness, which caused me to miss several classes.</span></p>
            <p><strong>Admin Response:</strong> <span id="admin-response">Your appeal is currently under review. We will notify you once a decision has been made.</span></p>
          </div>
          <button onclick="withdrawAppeal()" class="danger" style="width: auto;">Withdraw Appeal</button>
        </div>
      </div>
      
      <div class="card">
        <h3>Your Attendance Details</h3>
        <table id="student-attendance-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Subject</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      
      <!-- Appeal History -->
      <div class="card">
        <h3>Appeal History</h3>
        <table id="appeal-history-table">
          <thead>
            <tr>
              <th>Date Submitted</th>
              <th>Reason</th>
              <th>Status</th>
              <th>Admin Response</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    // Data storage helpers
    function getData(key) {
      return JSON.parse(localStorage.getItem(key)) || [];
    }

    function saveData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    // Initialize default data if not exists
    function initializeData() {
      if (!localStorage.getItem('students')) {
        const defaultStudents = [
          { id: 1, name: "John Doe", reg: "STU001", email: "john@example.com", course: "Computer Science", semester: "4", password: "password123" },
          { id: 2, name: "Jane Smith", reg: "STU002", email: "jane@example.com", course: "Information Technology", semester: "3", password: "password123" }
        ];
        saveData('students', defaultStudents);
      }
      
      if (!localStorage.getItem('lecturers')) {
        const defaultLecturers = [
          { id: 1, name: "Dr. Robert Johnson", lecturerId: "LEC001", email: "robert@example.com", department: "Computer Science", password: "password123" },
          { id: 2, name: "Prof. Sarah Williams", lecturerId: "LEC002", email: "sarah@example.com", department: "Mathematics", password: "password123" }
        ];
        saveData('lecturers', defaultLecturers);
      }
      
      if (!localStorage.getItem('attendance')) {
        const defaultAttendance = [
          { id: 1, studentReg: "STU001", subject: "Data Structures", date: "2023-10-01", status: "present" },
          { id: 2, studentReg: "STU001", subject: "Algorithms", date: "2023-10-02", status: "present" },
          { id: 3, studentReg: "STU001", subject: "Database Systems", date: "2023-10-03", status: "absent" },
          { id: 4, studentReg: "STU002", subject: "Data Structures", date: "2023-10-01", status: "present" },
          { id: 5, studentReg: "STU002", subject: "Algorithms", date: "2023-10-02", status: "absent" },
          { id: 6, studentReg: "STU002", subject: "Database Systems", date: "2023-10-03", status: "present" }
        ];
        saveData('attendance', defaultAttendance);
      }
      
      if (!localStorage.getItem('appeals')) {
        const defaultAppeals = [
          { id: 1, studentReg: "STU001", date: "2023-03-15", reason: "Medical Reasons", details: "I was hospitalized for two weeks due to severe illness.", status: "approved", adminResponse: "Appeal approved based on medical documentation provided." },
          { id: 2, studentReg: "STU002", date: "2022-11-20", reason: "Family Emergency", details: "Had to travel due to a family emergency.", status: "rejected", adminResponse: "Insufficient documentation provided to support the appeal." }
        ];
        saveData('appeals', defaultAppeals);
      }
      
      if (!localStorage.getItem('nextStudentId')) {
        localStorage.setItem('nextStudentId', '3');
      }
      
      if (!localStorage.getItem('nextLecturerId')) {
        localStorage.setItem('nextLecturerId', '3');
      }
      
      if (!localStorage.getItem('nextAttendanceId')) {
        localStorage.setItem('nextAttendanceId', '7');
      }
      
      if (!localStorage.getItem('nextAppealId')) {
        localStorage.setItem('nextAppealId', '3');
      }
    }

    // Show alert message
    function showAlert(alertId, message, type) {
      const alertElement = document.getElementById(alertId);
      alertElement.textContent = message;
      alertElement.className = 'alert';
      
      if (type === 'success') {
        alertElement.classList.add('alert-success');
      } else if (type === 'error') {
        alertElement.classList.add('alert-error');
      }
      
      alertElement.classList.remove('hidden');
      
      // Auto hide after 3 seconds
      setTimeout(() => {
        alertElement.classList.add('hidden');
      }, 3000);
    }

    // Navigation functions
    function showRoleSelection() {
      document.getElementById('role-selection').classList.remove('hidden');
      document.getElementById('admin-login').classList.add('hidden');
      document.getElementById('lecturer-login').classList.add('hidden');
      document.getElementById('student-login').classList.add('hidden');
      document.getElementById('lecturer-registration').classList.add('hidden');
      document.getElementById('student-registration').classList.add('hidden');
    }

    function showLoginForm(role) {
      showRoleSelection();
      document.getElementById('role-selection').classList.add('hidden');
      
      if (role === 'admin') {
        document.getElementById('admin-login').classList.remove('hidden');
      } else if (role === 'lecturer') {
        document.getElementById('lecturer-login').classList.remove('hidden');
      } else if (role === 'student') {
        document.getElementById('student-login').classList.remove('hidden');
      }
    }

    function showLecturerRegistration() {
      document.getElementById('lecturer-login').classList.add('hidden');
      document.getElementById('lecturer-registration').classList.remove('hidden');
    }

    function showStudentRegistration() {
      document.getElementById('student-login').classList.add('hidden');
      document.getElementById('student-registration').classList.remove('hidden');
    }

    // Login functions
    document.getElementById('admin-login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('admin-username').value;
      const password = document.getElementById('admin-password').value;
      
      // Default admin credentials
      if (username === 'admin' && password === 'admin123') {
        document.getElementById('admin-login').classList.add('hidden');
        document.getElementById('admin-dashboard').classList.remove('hidden');
        loadAdminDashboard();
      } else {
        showAlert('admin-login-alert', 'Invalid admin credentials!', 'error');
      }
    });

    document.getElementById('lecturer-login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const lecturerId = document.getElementById('lecturer-id').value;
      const password = document.getElementById('lecturer-password').value;
      
      const lecturers = getData('lecturers');
      const lecturer = lecturers.find(l => l.lecturerId === lecturerId && l.password === password);
      
      if (lecturer) {
        // Store current lecturer in session
        localStorage.setItem('currentLecturer', JSON.stringify(lecturer));
        
        document.getElementById('lecturer-login').classList.add('hidden');
        document.getElementById('lecturer-dashboard').classList.remove('hidden');
        loadLecturerDashboard();
      } else {
        showAlert('lecturer-login-alert', 'Invalid lecturer ID or password!', 'error');
      }
    });

    document.getElementById('student-login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const studentReg = document.getElementById('student-reg').value;
      const password = document.getElementById('student-password').value;
      
      const students = getData('students');
      const student = students.find(s => s.reg === studentReg && s.password === password);
      
      if (student) {
        // Store current student in session
        localStorage.setItem('currentStudent', JSON.stringify(student));
        
        document.getElementById('student-login').classList.add('hidden');
        document.getElementById('student-dashboard').classList.remove('hidden');
        loadStudentDashboard();
      } else {
        showAlert('student-login-alert', 'Invalid registration number or password!', 'error');
      }
    });

    // Registration functions
    document.getElementById('lecturer-reg-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('lecturer-name').value;
      const lecturerId = document.getElementById('lecturer-id-reg').value;
      const email = document.getElementById('lecturer-email').value;
      const department = document.getElementById('lecturer-department').value;
      const password = document.getElementById('lecturer-password-reg').value;
      const confirmPassword = document.getElementById('lecturer-confirm-password').value;
      
      if (password !== confirmPassword) {
        showAlert('lecturer-reg-alert', 'Passwords do not match!', 'error');
        return;
      }
      
      const lecturers = getData('lecturers');
      
      // Check if lecturer ID already exists
      if (lecturers.some(l => l.lecturerId === lecturerId)) {
        showAlert('lecturer-reg-alert', 'Lecturer ID already exists!', 'error');
        return;
      }
      
      const nextId = parseInt(localStorage.getItem('nextLecturerId'));
      const newLecturer = {
        id: nextId,
        name,
        lecturerId,
        email,
        department,
        password
      };
      
      lecturers.push(newLecturer);
      saveData('lecturers', lecturers);
      localStorage.setItem('nextLecturerId', (nextId + 1).toString());
      
      showAlert('lecturer-reg-alert', 'Lecturer registered successfully!', 'success');
      document.getElementById('lecturer-reg-form').reset();
      
      // Redirect to login after 2 seconds
      setTimeout(() => {
        showLoginForm('lecturer');
      }, 2000);
    });

    document.getElementById('student-reg-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('student-name').value;
      const reg = document.getElementById('student-reg-reg').value;
      const email = document.getElementById('student-email').value;
      const course = document.getElementById('student-course').value;
      const semester = document.getElementById('student-semester').value;
      const password = document.getElementById('student-password-reg').value;
      const confirmPassword = document.getElementById('student-confirm-password').value;
      
      if (password !== confirmPassword) {
        showAlert('student-reg-alert', 'Passwords do not match!', 'error');
        return;
      }
      
      const students = getData('students');
      
      // Check if registration number already exists
      if (students.some(s => s.reg === reg)) {
        showAlert('student-reg-alert', 'Registration number already exists!', 'error');
        return;
      }
      
      const nextId = parseInt(localStorage.getItem('nextStudentId'));
      const newStudent = {
        id: nextId,
        name,
        reg,
        email,
        course,
        semester,
        password
      };
      
      students.push(newStudent);
      saveData('students', students);
      localStorage.setItem('nextStudentId', (nextId + 1).toString());
      
      showAlert('student-reg-alert', 'Student registered successfully!', 'success');
      document.getElementById('student-reg-form').reset();
      
      // Redirect to login after 2 seconds
      setTimeout(() => {
        showLoginForm('student');
      }, 2000);
    });

    // Admin Dashboard Functions
    function loadAdminDashboard() {
      // Update statistics
      const students = getData('students');
      const lecturers = getData('lecturers');
      const attendance = getData('attendance');
      
      document.getElementById('total-students').textContent = students.length;
      document.getElementById('total-lecturers').textContent = lecturers.length;
      
      // Calculate eligibility
      let eligibleCount = 0;
      students.forEach(student => {
        const studentAttendance = attendance.filter(a => a.studentReg === student.reg);
        const presentCount = studentAttendance.filter(a => a.status === 'present').length;
        const totalCount = studentAttendance.length;
        const percentage = totalCount > 0 ? (presentCount / totalCount) * 100 : 0;
        
        if (percentage >= 75) {
          eligibleCount++;
        }
      });
      
      document.getElementById('eligible-students').textContent = eligibleCount;
      const eligibilityRate = students.length > 0 ? ((eligibleCount / students.length) * 100).toFixed(1) : 0;
      document.getElementById('eligibility-rate').textContent = `${eligibilityRate}%`;
      
      // Show default section
      showAdminSection('manage-students');
    }

    function showAdminSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.admin-section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.remove('hidden');
      
      // Load section data
      if (sectionId === 'manage-students') {
        loadStudentsTable();
      } else if (sectionId === 'manage-lecturers') {
        loadLecturersTable();
      } else if (sectionId === 'attendance-records') {
        loadAttendanceTable();
      } else if (sectionId === 'appeals-management') {
        loadAppealsTable();
      }
    }

    function loadStudentsTable() {
      const students = getData('students');
      const tbody = document.querySelector('#students-table tbody');
      tbody.innerHTML = '';
      
      students.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.reg}</td>
          <td>${student.course}</td>
          <td>${student.semester}</td>
          <td>
            <button class="danger" style="width: auto; padding: 5px 10px;" onclick="deleteStudent(${student.id})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadLecturersTable() {
      const lecturers = getData('lecturers');
      const tbody = document.querySelector('#lecturers-table tbody');
      tbody.innerHTML = '';
      
      lecturers.forEach(lecturer => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${lecturer.name}</td>
          <td>${lecturer.lecturerId}</td>
          <td>${lecturer.department}</td>
          <td>${lecturer.email}</td>
          <td>
            <button class="danger" style="width: auto; padding: 5px 10px;" onclick="deleteLecturer(${lecturer.id})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadAttendanceTable() {
      const students = getData('students');
      const attendance = getData('attendance');
      const tbody = document.querySelector('#attendance-table tbody');
      tbody.innerHTML = '';
      
      students.forEach(student => {
        const studentAttendance = attendance.filter(a => a.studentReg === student.reg);
        const presentCount = studentAttendance.filter(a => a.status === 'present').length;
        const totalCount = studentAttendance.length;
        const percentage = totalCount > 0 ? ((presentCount / totalCount) * 100).toFixed(1) : 0;
        const eligible = percentage >= 75;
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.reg}</td>
          <td>${totalCount}</td>
          <td>${presentCount}</td>
          <td>${percentage}%</td>
          <td>
            <span class="eligibility-badge ${eligible ? 'eligible' : 'not-eligible'}">
              ${eligible ? 'Eligible' : 'Not Eligible'}
            </span>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadAppealsTable() {
      const appeals = getData('appeals');
      const students = getData('students');
      const tbody = document.querySelector('#appeals-table tbody');
      tbody.innerHTML = '';
      
      appeals.forEach(appeal => {
        const student = students.find(s => s.reg === appeal.studentReg);
        if (student) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${student.name}</td>
            <td>${appeal.studentReg}</td>
            <td>${appeal.date}</td>
            <td>${appeal.reason}</td>
            <td>
              <span class="appeal-status ${appeal.status}">${appeal.status.charAt(0).toUpperCase() + appeal.status.slice(1)}</span>
            </td>
            <td>
              <button class="success" style="width: auto; padding: 5px 10px; margin-right: 5px;" onclick="updateAppealStatus(${appeal.id}, 'approved')">Approve</button>
              <button class="danger" style="width: auto; padding: 5px 10px;" onclick="updateAppealStatus(${appeal.id}, 'rejected')">Reject</button>
            </td>
          `;
          tbody.appendChild(row);
        }
      });
    }

    function updateAppealStatus(appealId, status) {
      const appeals = getData('appeals');
      const appealIndex = appeals.findIndex(a => a.id === appealId);
      
      if (appealIndex !== -1) {
        appeals[appealIndex].status = status;
        appeals[appealIndex].adminResponse = status === 'approved' 
          ? 'Your appeal has been approved. You are now eligible for the examination.' 
          : 'Your appeal has been rejected. Please contact administration for more details.';
        
        saveData('appeals', appeals);
        loadAppealsTable();
        
        alert(`Appeal ${status} successfully!`);
      }
    }

    function deleteStudent(studentId) {
      if (confirm('Are you sure you want to delete this student?')) {
        const students = getData('students');
        const updatedStudents = students.filter(s => s.id !== studentId);
        saveData('students', updatedStudents);
        loadStudentsTable();
        loadAdminDashboard(); // Refresh stats
      }
    }

    function deleteLecturer(lecturerId) {
      if (confirm('Are you sure you want to delete this lecturer?')) {
        const lecturers = getData('lecturers');
        const updatedLecturers = lecturers.filter(l => l.id !== lecturerId);
        saveData('lecturers', updatedLecturers);
        loadLecturersTable();
        loadAdminDashboard(); // Refresh stats
      }
    }

    function generateReport() {
      const reportType = document.getElementById('report-type').value;
      const resultsDiv = document.getElementById('report-results');
      resultsDiv.innerHTML = '';
      
      if (reportType === 'eligibility') {
        const students = getData('students');
        const attendance = getData('attendance');
        
        let html = '<h4>Eligibility Report</h4><table><thead><tr><th>Student Name</th><th>Reg. No.</th><th>Attendance %</th><th>Eligibility</th></tr></thead><tbody>';
        
        students.forEach(student => {
          const studentAttendance = attendance.filter(a => a.studentReg === student.reg);
          const presentCount = studentAttendance.filter(a => a.status === 'present').length;
          const totalCount = studentAttendance.length;
          const percentage = totalCount > 0 ? ((presentCount / totalCount) * 100).toFixed(1) : 0;
          const eligible = percentage >= 75;
          
          html += `<tr>
            <td>${student.name}</td>
            <td>${student.reg}</td>
            <td>${percentage}%</td>
            <td>${eligible ? 'Eligible' : 'Not Eligible'}</td>
          </tr>`;
        });
        
        html += '</tbody></table>';
        resultsDiv.innerHTML = html;
      } else if (reportType === 'students') {
        const students = getData('students');
        
        let html = '<h4>Student List</h4><table><thead><tr><th>Name</th><th>Reg. No.</th><th>Course</th><th>Semester</th><th>Email</th></tr></thead><tbody>';
        
        students.forEach(student => {
          html += `<tr>
            <td>${student.name}</td>
            <td>${student.reg}</td>
            <td>${student.course}</td>
            <td>${student.semester}</td>
            <td>${student.email}</td>
          </tr>`;
        });
        
        html += '</tbody></table>';
        resultsDiv.innerHTML = html;
      } else if (reportType === 'lecturers') {
        const lecturers = getData('lecturers');
        
        let html = '<h4>Lecturer List</h4><table><thead><tr><th>Name</th><th>Lecturer ID</th><th>Department</th><th>Email</th></tr></thead><tbody>';
        
        lecturers.forEach(lecturer => {
          html += `<tr>
            <td>${lecturer.name}</td>
            <td>${lecturer.lecturerId}</td>
            <td>${lecturer.department}</td>
            <td>${lecturer.email}</td>
          </tr>`;
        });
        
        html += '</tbody></table>';
        resultsDiv.innerHTML = html;
      } else if (reportType === 'appeals') {
        const appeals = getData('appeals');
        const students = getData('students');
        
        let html = '<h4>Appeals Report</h4><table><thead><tr><th>Student Name</th><th>Reg. No.</th><th>Appeal Date</th><th>Reason</th><th>Status</th></tr></thead><tbody>';
        
        appeals.forEach(appeal => {
          const student = students.find(s => s.reg === appeal.studentReg);
          if (student) {
            html += `<tr>
              <td>${student.name}</td>
              <td>${appeal.studentReg}</td>
              <td>${appeal.date}</td>
              <td>${appeal.reason}</td>
              <td>${appeal.status.charAt(0).toUpperCase() + appeal.status.slice(1)}</td>
            </tr>`;
          }
        });
        
        html += '</tbody></table>';
        resultsDiv.innerHTML = html;
      }
    }

    function exportToCSV() {
      const reportType = document.getElementById('report-type').value;
      let csvContent = "data:text/csv;charset=utf-8,";
      
      if (reportType === 'eligibility') {
        const students = getData('students');
        const attendance = getData('attendance');
        
        csvContent += "Student Name,Registration Number,Attendance %,Eligibility\n";
        
        students.forEach(student => {
          const studentAttendance = attendance.filter(a => a.studentReg === student.reg);
          const presentCount = studentAttendance.filter(a => a.status === 'present').length;
          const totalCount = studentAttendance.length;
          const percentage = totalCount > 0 ? ((presentCount / totalCount) * 100).toFixed(1) : 0;
          const eligible = percentage >= 75 ? "Eligible" : "Not Eligible";
          
          csvContent += `${student.name},${student.reg},${percentage}%,${eligible}\n`;
        });
      } else if (reportType === 'students') {
        const students = getData('students');
        
        csvContent += "Name,Registration Number,Course,Semester,Email\n";
        
        students.forEach(student => {
          csvContent += `${student.name},${student.reg},${student.course},${student.semester},${student.email}\n`;
        });
      } else if (reportType === 'lecturers') {
        const lecturers = getData('lecturers');
        
        csvContent += "Name,Lecturer ID,Department,Email\n";
        
        lecturers.forEach(lecturer => {
          csvContent += `${lecturer.name},${lecturer.lecturerId},${lecturer.department},${lecturer.email}\n`;
        });
      } else if (reportType === 'appeals') {
        const appeals = getData('appeals');
        const students = getData('students');
        
        csvContent += "Student Name,Registration Number,Appeal Date,Reason,Status\n";
        
        appeals.forEach(appeal => {
          const student = students.find(s => s.reg === appeal.studentReg);
          if (student) {
            csvContent += `${student.name},${appeal.studentReg},${appeal.date},${appeal.reason},${appeal.status}\n`;
          }
        });
      }
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", `${reportType}_report.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Lecturer Dashboard Functions
    function loadLecturerDashboard() {
      const currentLecturer = JSON.parse(localStorage.getItem('currentLecturer'));
      
      document.getElementById('lecturer-name-display').textContent = currentLecturer.name;
      document.getElementById('lecturer-dept-display').textContent = currentLecturer.department;
      
      // Load students for attendance recording
      loadStudentsForAttendance();
      
      // Show default section
      showLecturerSection('record-attendance');
    }

    function showLecturerSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.lecturer-section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.remove('hidden');
      
      // Load section data
      if (sectionId === 'view-students') {
        loadLecturerStudentsTable();
      }
    }

    function loadStudentsForAttendance() {
      const students = getData('students');
      const select = document.getElementById('attendance-student');
      select.innerHTML = '<option value="">Select Student</option>';
      
      students.forEach(student => {
        const option = document.createElement('option');
        option.value = student.reg;
        option.textContent = `${student.name} (${student.reg})`;
        select.appendChild(option);
      });
    }

    document.getElementById('record-attendance-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const studentReg = document.getElementById('attendance-student').value;
      const subject = document.getElementById('attendance-subject').value;
      const date = document.getElementById('attendance-date').value;
      const status = document.getElementById('attendance-status').value;
      
      const attendance = getData('attendance');
      const nextId = parseInt(localStorage.getItem('nextAttendanceId'));
      
      const newAttendance = {
        id: nextId,
        studentReg,
        subject,
        date,
        status
      };
      
      attendance.push(newAttendance);
      saveData('attendance', attendance);
      localStorage.setItem('nextAttendanceId', (nextId + 1).toString());
      
      showAlert('attendance-alert', 'Attendance recorded successfully!', 'success');
      document.getElementById('record-attendance-form').reset();
    });

    function loadLecturerStudentsTable() {
      const students = getData('students');
      const attendance = getData('attendance');
      const tbody = document.querySelector('#lecturer-students-table tbody');
      tbody.innerHTML = '';
      
      students.forEach(student => {
        const studentAttendance = attendance.filter(a => a.studentReg === student.reg);
        const presentCount = studentAttendance.filter(a => a.status === 'present').length;
        const totalCount = studentAttendance.length;
        const percentage = totalCount > 0 ? ((presentCount / totalCount) * 100).toFixed(1) : 0;
        const eligible = percentage >= 75;
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.reg}</td>
          <td>${student.course}</td>
          <td>${student.semester}</td>
          <td>${percentage}%</td>
          <td>
            <span class="eligibility-badge ${eligible ? 'eligible' : 'not-eligible'}">
              ${eligible ? 'Eligible' : 'Not Eligible'}
            </span>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function generateLecturerReport() {
      const subject = document.getElementById('report-subject').value;
      const resultsDiv = document.getElementById('lecturer-report-results');
      const students = getData('students');
      const attendance = getData('attendance');
      
      let html = '<h4>Attendance Report</h4><table><thead><tr><th>Student Name</th><th>Reg. No.</th><th>Subject</th><th>Total Classes</th><th>Present</th><th>Absent</th><th>Attendance %</th></tr></thead><tbody>';
      
      students.forEach(student => {
        let studentAttendance;
        if (subject === 'all') {
          studentAttendance = attendance.filter(a => a.studentReg === student.reg);
        } else {
          studentAttendance = attendance.filter(a => a.studentReg === student.reg && a.subject === subject);
        }
        
        const presentCount = studentAttendance.filter(a => a.status === 'present').length;
        const absentCount = studentAttendance.filter(a => a.status === 'absent').length;
        const totalCount = studentAttendance.length;
        const percentage = totalCount > 0 ? ((presentCount / totalCount) * 100).toFixed(1) : 0;
        
        if (subject === 'all') {
          html += `<tr>
            <td>${student.name}</td>
            <td>${student.reg}</td>
            <td>All Subjects</td>
            <td>${totalCount}</td>
            <td>${presentCount}</td>
            <td>${absentCount}</td>
            <td>${percentage}%</td>
          </tr>`;
        } else {
          html += `<tr>
            <td>${student.name}</td>
            <td>${student.reg}</td>
            <td>${subject}</td>
            <td>${totalCount}</td>
            <td>${presentCount}</td>
            <td>${absentCount}</td>
            <td>${percentage}%</td>
          </tr>`;
        }
      });
      
      html += '</tbody></table>';
      resultsDiv.innerHTML = html;
    }

    // Student Dashboard Functions
    function loadStudentDashboard() {
      const currentStudent = JSON.parse(localStorage.getItem('currentStudent'));
      const attendance = getData('attendance');
      const appeals = getData('appeals');
      
      document.getElementById('student-name-display').textContent = currentStudent.name;
      document.getElementById('student-reg-display').textContent = currentStudent.reg;
      document.getElementById('student-course-display').textContent = currentStudent.course;
      document.getElementById('student-semester-display').textContent = currentStudent.semester;
      
      // Calculate attendance statistics
      const studentAttendance = attendance.filter(a => a.studentReg === currentStudent.reg);
      const presentCount = studentAttendance.filter(a => a.status === 'present').length;
      const totalCount = studentAttendance.length;
      const percentage = totalCount > 0 ? ((presentCount / totalCount) * 100).toFixed(1) : 0;
      const eligible = percentage >= 75;
      
      document.getElementById('student-attendance-percent').textContent = `${percentage}%`;
      document.getElementById('student-total-lectures').textContent = totalCount;
      document.getElementById('student-attended-lectures').textContent = presentCount;
      
      const eligibilityStatus = document.getElementById('student-eligibility-status');
      eligibilityStatus.textContent = eligible ? 'Eligible' : 'Not Eligible';
      eligibilityStatus.className = eligible ? 'eligible' : 'not-eligible';
      
      // Load attendance details
      const tbody = document.querySelector('#student-attendance-table tbody');
      tbody.innerHTML = '';
      
      studentAttendance.forEach(record => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${record.date}</td>
          <td>${record.subject}</td>
          <td>
            <span class="attendance-indicator" style="background: ${record.status === 'present' ? 'var(--success)' : 'var(--danger)'}"></span>
            ${record.status === 'present' ? 'Present' : 'Absent'}
          </td>
        `;
        tbody.appendChild(row);
      });
      
      // Load appeal history
      const appealHistoryTbody = document.querySelector('#appeal-history-table tbody');
      appealHistoryTbody.innerHTML = '';
      
      const studentAppeals = appeals.filter(a => a.studentReg === currentStudent.reg);
      studentAppeals.forEach(appeal => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${appeal.date}</td>
          <td>${appeal.reason}</td>
          <td><span class="appeal-status ${appeal.status}">${appeal.status.charAt(0).toUpperCase() + appeal.status.slice(1)}</span></td>
          <td>${appeal.adminResponse}</td>
        `;
        appealHistoryTbody.appendChild(row);
      });
      
      // Check if student has a pending appeal
      const pendingAppeal = studentAppeals.find(a => a.status === 'pending');
      
      if (pendingAppeal) {
        showAppealStatus(pendingAppeal);
      } else {
        // Only show appeal form if student is not eligible
        if (!eligible) {
          showAppealForm();
        } else {
          document.getElementById('appeal-info').textContent = "Your attendance meets the required 75% threshold. No appeal is necessary.";
          document.getElementById('appeal-form').classList.add('hidden');
        }
      }
    }

    // Show appeal form
    function showAppealForm() {
      document.getElementById('appeal-form').classList.remove('hidden');
      document.getElementById('appeal-status').classList.add('hidden');
    }

    // Show appeal status
    function showAppealStatus(appeal) {
      document.getElementById('appeal-form').classList.add('hidden');
      document.getElementById('appeal-status').classList.remove('hidden');
      
      document.getElementById('appeal-date').textContent = appeal.date;
      document.getElementById('appeal-reason-display').textContent = appeal.reason;
      document.getElementById('appeal-details-display').textContent = appeal.details;
      document.getElementById('admin-response').textContent = appeal.adminResponse;
      
      const statusElement = document.getElementById('appeal-status-display');
      statusElement.textContent = appeal.status.charAt(0).toUpperCase() + appeal.status.slice(1) + ' Review';
      statusElement.className = `appeal-status ${appeal.status}`;
    }

    // Submit appeal form
    document.getElementById('submit-appeal-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const reason = document.getElementById('appeal-reason').value;
      const details = document.getElementById('appeal-details').value;
      const currentStudent = JSON.parse(localStorage.getItem('currentStudent'));
      
      // In a real application, this would send data to the server
      const appeals = getData('appeals');
      const nextId = parseInt(localStorage.getItem('nextAppealId'));
      
      // Set current date
      const currentDate = new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      const newAppeal = {
        id: nextId,
        studentReg: currentStudent.reg,
        date: currentDate,
        reason,
        details,
        status: 'pending',
        adminResponse: 'Your appeal is currently under review. We will notify you once a decision has been made.'
      };
      
      appeals.push(newAppeal);
      saveData('appeals', appeals);
      localStorage.setItem('nextAppealId', (nextId + 1).toString());
      
      showAppealStatus(newAppeal);
      
      // Show success message
      alert('Your appeal has been submitted successfully! It will be reviewed by the administration.');
    });

    // Withdraw appeal
    function withdrawAppeal() {
      if (confirm('Are you sure you want to withdraw your appeal? This action cannot be undone.')) {
        const currentStudent = JSON.parse(localStorage.getItem('currentStudent'));
        const appeals = getData('appeals');
        
        // Find and remove the pending appeal
        const updatedAppeals = appeals.filter(a => !(a.studentReg === currentStudent.reg && a.status === 'pending'));
        saveData('appeals', updatedAppeals);
        
        showAppealForm();
        
        // Reset form
        document.getElementById('submit-appeal-form').reset();
        
        alert('Your appeal has been withdrawn successfully.');
      }
    }

    // Logout function
    function logout() {
      // Clear current user session
      localStorage.removeItem('currentLecturer');
      localStorage.removeItem('currentStudent');
      
      // Hide all dashboards
      document.getElementById('admin-dashboard').classList.add('hidden');
      document.getElementById('lecturer-dashboard').classList.add('hidden');
      document.getElementById('student-dashboard').classList.add('hidden');
      
      // Show role selection
      showRoleSelection();
    }

    // Initialize the application
    initializeData();
  </script>
</body>
</html>